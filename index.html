
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vape & Табак</title>
  <style>
    body { font-family: sans-serif; margin: 20px; padding: 0; background: #f5f5f5; }
    .admin-btn {
      position: fixed; top: 20px; right: 20px; background: #444; color: #fff;
      padding: 10px 16px; border: none; border-radius: 8px; cursor: pointer;
      font-weight: bold; z-index: 1000;
    }
    .editable {
      border: 1px dashed transparent;
      padding: 5px;
    }
    .editable[contenteditable="true"] {
      border: 1px dashed #888;
      background: #fff8dc;
    }
    .section {
      margin-bottom: 20px;
      padding: 10px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .save-btn {
      display: none;
      margin-top: 10px;
      padding: 5px 10px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .save-btn.show {
      display: inline-block;
    }
  </style>
</head>
<body>

<button class="admin-btn" onclick="enterAdmin()">АДМИН</button>

<div id="content"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzv0ypwSrQJiLu4dUq4q_M8w5x3RJ9Xzt235v1zq0e0aAja1VqksfqRDOKzNmbgYZDwPA/exec";
const ADMIN_PASSWORD = "admin123";
let isAdmin = false;

async function loadContent() {
  const res = await fetch(API_URL);
  const data = await res.json();
  const content = document.getElementById("content");
  content.innerHTML = "";

  data.forEach((item, index) => {
    const section = document.createElement("div");
    section.className = "section";

    const text = document.createElement("div");
    text.className = "editable";
    text.innerText = item.text;
    if (isAdmin) text.setAttribute("contenteditable", "true");

    const saveBtn = document.createElement("button");
    saveBtn.className = "save-btn";
    saveBtn.innerText = "Сохранить";
    saveBtn.onclick = () => saveChanges(item.id, text.innerText, saveBtn);

    if (isAdmin) saveBtn.classList.add("show");

    section.appendChild(text);
    section.appendChild(saveBtn);
    content.appendChild(section);
  });
}

async function saveChanges(id, newText, btn) {
  btn.innerText = "Сохраняю...";
  const response = await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ id: id, text: newText }),
    headers: { "Content-Type": "application/json" }
  });
  const result = await response.text();
  btn.innerText = result === "OK" ? "Сохранено!" : "Ошибка";
  setTimeout(() => btn.innerText = "Сохранить", 2000);
}

function enterAdmin() {
  const pass = prompt("Введите пароль администратора:");
  if (pass === ADMIN_PASSWORD) {
    isAdmin = true;
    loadContent();
  } else {
    alert("Неверный пароль!");
  }
}

window.onload = loadContent;
</script>

</body>
</html>
